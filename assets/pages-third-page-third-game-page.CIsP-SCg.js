import{_ as a,j as e,b$ as s,aV as l,aa as o,u as n,z as t,U as c,F as d,Y as i,o as r,d as g,w as u,aj as m,ak as p,V as f,i as v,e as y,aW as h,W as b,ar as j}from"./index-SUU5mfSv.js";import{b as w,c as C}from"./uni-app.es.BFzw-cPf.js";const _=a({__name:"third-game-page",setup(a){const _=e();let k=null;w((a=>{j({gameBusy:!0,action:!0}),s({rid:a.rid,success:a=>{l({title:a.title}),_.value=a.gameH5,k=a.gameConfig}})})),C((()=>{j({gameBusy:!0,action:!1})}));const I=()=>{1==m().length?history.back():p()},L=e(!1);let B=null;o((()=>{window.removeEventListener("message",W,!1),null!=B&&(B.pause(),B=null)}));let E=null;const F=(a,e)=>{var s={jsMethods:a,jsData:JSON.stringify(e)};null!=E&&E.postMessage(s,"*")},N=n().$onAction((({name:a})=>{"balanceChangedNotification"==a&&(console.log("游戏 用户余额变动"),F("walletUpdate",{userId:t()}))}));let O=!1;const W=a=>{if(a.data){var e=JSON.parse(a.data).jsCallback;e.includes("getConfig")?(console.log("游戏 传入游戏所需config"),F(e,k)):e.includes("destroy")?(console.log("游戏 收到游戏destroy"),N(),I()):e.includes("gameRecharge")?(console.log("游戏 收到游戏充值"),0==O&&(O=!0,c({path:f.gameRecharge,callback:()=>{console.log("充值弹窗关闭"),O=!1}}))):e.includes("gameLoaded")&&console.log("游戏 收到游戏gameLoaded")}};return window.addEventListener("message",W,!1),d((()=>{B=i({targets:".game-load-loading",scale:[.9,1],loop:!0,autoplay:!0,duration:250,delay:250,easing:"easeInOutCirc",direction:"alternate",loopComplete:a=>{console.log("游戏 一次循环结束")}});const a=document.getElementById("gameIFrame");a.onload=()=>{E=a.contentWindow,console.log("游戏 游戏load完成"),L.value=!0,null!=B&&(B.pause(),B=null)}})),(a,e)=>{const s=v;return r(),g(s,{class:"content"},{default:u((()=>[y(s,{class:"nav-area"},{default:u((()=>[y(s,{onClick:I,class:"close"})])),_:1}),h("iframe",{id:"gameIFrame",class:"third-content",src:_.value,frameborder:"0"},null,8,["src"]),L.value?b("",!0):(r(),g(s,{key:0,class:"game-load-loading"}))])),_:1})}}},[["__scopeId","data-v-69580053"]]);export{_ as default};
