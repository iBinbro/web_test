import{_ as l,h as a,u as e,j as t,aA as n,as as u,bk as s,o,d as i,w as r,i as d,e as c,R as v,S as f,a3 as m,T as p,P as y,Q as g,bl as b,bm as _,bn as h,an as k,n as $,bo as x,bp as w,aj as F,ak as D,a2 as K,f as V,aT as C,bq as I,br as N,bs as T}from"./index-SUU5mfSv.js";const U=l({__name:"edit-profile",setup(l){var U,Y,j;const{userDetail:z}=a(e()),S=t("ar"==n()?30:20),q=t(null==(U=z.value)?void 0:U.nickname),A=t(null==(Y=z.value)?void 0:Y.userId);null==q.value&&u(z,(async(l,a)=>{var e,t;q.value=null==(e=z.value)?void 0:e.nickname,A.value=null==(t=z.value)?void 0:t.userId}),{once:!0});const B=new Date,J=B.getFullYear()-18,O=B.getFullYear()-100,P=t(s((new Date).setFullYear(O))),Q=t(s((new Date).setFullYear(J))),R=null==(j=z.value)?void 0:j.birthday,E=0!=R?s(R):"";console.log(`更新用户信息 当前时间 ${E}`);const G=t(E),H=l=>{console.log(`更新用户信息 日期选择变更 ${JSON.stringify(l)}`),G.value=l.detail.value},L=()=>{b({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(l){console.log("更新用户信息 获取到图片并开始上传");const a=l.tempFiles[0].name.split("."),e=a[a.length-1],t=l.tempFiles[0];_(),h({suffix:e,success:l=>{const a=l.uploadUrl;console.log("更新用户信息 图片开始上传至云"),N({uploadUrl:a,file:t,success:()=>{console.log("更新用户信息 图片上传完成立刻修改为头像"),M(l.publicUrl)},fail:()=>{T()},netFail:()=>{T()}})},fail:()=>{T()},netFail:()=>{T()}})}})},M=l=>{var a,e,t,n,u,o;let i=null,r=null,d=l;if(null!=l&&(null==(a=z.value)?void 0:a.portrait)!=l)console.log(`更新用户信息 头像发生了改变 ${null==(e=z.value)?void 0:e.portrait} => ${l}`),d=l;else{if((null==(t=z.value)?void 0:t.nickname)!=q.value&&(console.log(`更新用户信息 昵称发生了改变 ${null==(n=z.value)?void 0:n.nickname} => ${q.value}`),i=q.value,""==i))return void k({content:$.enterNickName.tr});s(null==(u=z.value)?void 0:u.birthday)!=G.value&&(console.log(`更新用户信息 生日发生了改变 ${s(null==(o=z.value)?void 0:o.birthday)} => ${G.value}`),r=new Date(G.value).getTime())}null!=i||null!=r||null!=d?x({nickname:i,birthday:r,portrait:d,loading:null==d,success:l=>{null!=d&&T(),null!=i&&(z.value.nickname=i),null!=r&&(z.value.birthday=r),null!=d&&(z.value.portrait=d)},fail:()=>{null!=d&&T()},netFail:()=>{null!=d&&T()}}):console.log("更新用户信息 未修改任何信息 无操作")},W=()=>{var l,a;if(s(null==(l=z.value)?void 0:l.birthday)!=G.value||(null==(a=z.value)?void 0:a.nickname)!=q.value)return void w({content:$.confirmNoCommit.tr,confirm:()=>{1==F().length?history.back():D()}});1==F().length?history.back():D()};return(l,a)=>{const e=d,t=K,n=V,u=C,b=I;return o(),i(e,{class:"bg"},{default:r((()=>[c(e,{class:"nav-area"},{default:r((()=>[c(e,{onClick:W,class:"close"}),c(t,null,{default:r((()=>[v(f(l.$lanKey.accountSetting.tr),1)])),_:1})])),_:1}),c(e,{class:"content"},{default:r((()=>[c(e,{class:"avatar"},{default:r((()=>{var a;return[c(t,null,{default:r((()=>[v(f(l.$lanKey.avatar.tr),1)])),_:1}),c(e,{onClick:L,class:"user-portrait place-holder-gradient",style:m({backgroundImage:`url(${null==(a=p(z))?void 0:a.portrait})`})},{default:r((()=>[c(e,{class:"edit-icon"},{default:r((()=>[c(n,{src:"data:image/svg+xml,%3csvg%20height='16'%20viewBox='0%200%201024%201024'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m341.88918%20824.934409-156.438477-4.778485c-30.112036-.948112-54.307854-26.471286-55.180117-58.214075l-4.550938-165.047333a61.816901%2061.816901%200%200%201%2016.686771-44.10617l507.239909-535.19025a54.800872%2054.800872%200%200%201%2080.475745%200l160.913565%20169.712044c10.694703%2011.26357%2016.686771%2026.547135%2016.686771%2042.475417%200%2015.928281-5.992068%2031.211846-16.686771%2042.475417l-507.277833%20535.114401a55.36974%2055.36974%200%200%201%20-41.868625%2017.521109zm-341.88918%20199.065591v-120.030977h1023.960938v120.030977z'%20fill='%23fff'/%3e%3c/svg%3e",mode:"aspectFit"})])),_:1})])),_:1},8,["style"])]})),_:1}),c(e,{class:"input-area"},{default:r((()=>[c(e,{style:{display:"flex"}},{default:r((()=>{var a;return[y(c(e,{class:"red-dot"},null,512),[[g,(null==(a=p(z))?void 0:a.nickname)!=q.value]]),c(t,null,{default:r((()=>[v(f(l.$lanKey.nickName.tr),1)])),_:1})]})),_:1}),c(e,{class:"input-content"},{default:r((()=>[c(u,{maxlength:S.value,type:"text",name:"nickname",modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=l=>q.value=l)},null,8,["maxlength","modelValue"])])),_:1}),c(e,{style:{display:"flex"}},{default:r((()=>[c(t,null,{default:r((()=>[v(f(l.$lanKey.userId.tr),1)])),_:1})])),_:1}),c(e,{class:"input-content"},{default:r((()=>[c(u,{type:"text",style:{color:"#ffffff80"},disabled:"",name:"userid",modelValue:A.value,"onUpdate:modelValue":a[1]||(a[1]=l=>A.value=l)},null,8,["modelValue"])])),_:1}),c(e,{style:{display:"flex"}},{default:r((()=>{var a;return[y(c(e,{class:"red-dot"},null,512),[[g,p(s)(null==(a=p(z))?void 0:a.birthday)!=G.value]]),c(t,null,{default:r((()=>[v(f(l.$lanKey.birthDay.tr),1)])),_:1})]})),_:1}),c(e,{class:"input-content"},{default:r((()=>[c(b,{style:{color:"#ffffff80"},mode:"date",value:G.value,start:P.value,end:Q.value,onChange:H},{default:r((()=>[""!=G.value?(o(),i(e,{key:0},{default:r((()=>[v(f(G.value),1)])),_:1})):(o(),i(e,{key:1},{default:r((()=>[v(f(l.$lanKey.birthDay.tr)+"...",1)])),_:1}))])),_:1},8,["value","start","end"])])),_:1})])),_:1}),c(e,{class:"complete-btn-place"}),c(e,{onClick:a[2]||(a[2]=l=>M(null)),class:"complete-btn"},{default:r((()=>[c(t,null,{default:r((()=>[v(f(l.$lanKey.save.tr),1)])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-b20ccdd5"]]);export{U as default};
