import{_ as a,k as l,b4 as e,b1 as s,h as t,u as n,j as u,av as c,g as o,bd as d,ae as i,z as r,aC as f,X as v,J as _,o as m,d as p,w as y,i as g,e as h,P as $,Q as C,R as k,S as x,T as I,U as b,V as K,a3 as D,a4 as O,W as T,L as P,N as B,O as M,aj as S,ak as w,p as A,af as E,a5 as j,a0 as U,m as F,a2 as H,a6 as V}from"./index-SUU5mfSv.js";const z=a({__name:"video-chat-end",setup(a){const z=l("videoCallData"),J=z.anchorUserId;e(),s();const L=()=>{1==S().length?history.back():w()},{userBalance:N,userDetail:Q,userHaveMatchCard:R,userHaveCallCard:W}=t(n()),X=u({});c({anchorUserId:J,success:a=>{X.value=a}});const q=o(),G=u(null),Y=u(!1),Z=u(!1),aa=u(null==z?void 0:z.callType),la=u("0"),ea=u(q.matchCardDiamonds),sa=u("--:--"),ta=u(!1),na=u("0"),ua=u("--:--"),ca=l("virtualVideoEnd");if(G.value=z.type,console.log("通话结束页 判定类型"),1==G.value){console.log("通话结束页 这是虚拟视频"),Y.value=ca.usedMatchPropFlag,la.value=ca.giftAmount,ta.value=!0===(null==ca?void 0:ca.isAiv);const a=ca.totalCallTime,l=Math.floor(a/3600),e=Math.floor(a%3600/60),s=a%60,t=String(l).padStart(2,"0"),n=String(e).padStart(2,"0"),u=String(s).padStart(2,"0");sa.value=`${t}:${n}:${u}`}else{console.log("通话结束页 真实通话结束后的结算页面接口");const a=l("videoCallChannelId");d({channelId:a,endType:0,clientEndAt:Date.now(),clientDuration:ca.totalCallTime,success:a=>{if(ua.value=a.totalCallTime,na.value=a.callAmount,la.value=Math.abs(a.giftAmount),Y.value=a.usedMatchPropFlag,Z.value=a.usedCallPropFlag,!0===z.hadEnd);else{z.hadEnd=!0,i({key:"videoCallData",value:z});const l=Date.now(),e={text:a.totalCallTime},s=r(),t=!0===z.localInvite?s:J,u={data:e,messageType:-43,userInfo:{uid:t,virtualId:t},read:0,timestamp:l,mid:`${s}_${J}_${l}`};n().addConversation(`${s}_${J}`,u)}}})}f({});const oa=u([]);v({success:a=>{a.length>4?oa.value=a.slice(0,4):oa.value=a}});const da=()=>{A()?1==G.value||2==aa.value?(console.log("通话结束页 继续匹配"),E({url:"/pages/tab_bar/match/matching"})):(console.log("通话结束页 继续通话"),j({anchorId:J})):U()},ia=u(l("devicePermission"));return!1===ia.value?(console.log("用户明确拒绝了 弹出下载app提示"),_()):!0===ia.value?console.log("用户正常使用设备"):console.log("用户未确定 显示开启设备提示"),(a,l)=>{const e=H,s=g;return m(),p(s,{class:"content"},{default:y((()=>[h(s,{class:"top-area"},{default:y((()=>[$(h(s,{class:"permission-tip",onClick:l[0]||(l[0]=a=>{F({success:()=>{ia.value=!0},fail:()=>{ia.value=!1,_()}})})},{default:y((()=>[h(e,{class:"tip"},{default:y((()=>[k(x(a.$lanKey.mediaDiveceDisable.tr),1)])),_:1}),h(s,{class:"add"},{default:y((()=>[k(x(a.$lanKey.toOpen.tr),1)])),_:1})])),_:1},512),[[C,!0!==ia.value]]),h(s,{class:"balance-info"},{default:y((()=>[h(s,{class:"diamond-choose",onClick:l[1]||(l[1]=a=>I(b)({path:I(K).callEnd}))},{default:y((()=>[h(s,{class:"diamond-image"}),h(e,{class:"diamond-text"},{default:y((()=>[k(x(I(N)),1)])),_:1}),h(s,{class:"diamond-add"})])),_:1}),h(s,{class:"cancel",onClick:L})])),_:1})])),_:1}),h(s,{style:{padding:"0 32rpx 32rpx 32rpx"}},{default:y((()=>[h(s,{class:"anchor-info"},{default:y((()=>{var a;return[h(s,{class:"portrait",style:D({backgroundImage:`url(${null==(a=X.value)?void 0:a.portrait})`})},null,8,["style"]),h(e,{class:"nick-name"},{default:y((()=>{var a;return[k(x(null==(a=X.value)?void 0:a.nickname),1)]})),_:1})]})),_:1}),h(s,{class:"video-call-detail"},{default:y((()=>[1==G.value?(m(),p(s,{key:0},{default:y((()=>[h(s,{class:"detail",style:{"margin-bottom":"48rpx"}},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[h(s,{class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>[k(x(sa.value),1)])),_:1})])),_:1})])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.callDuration.tr),1)])),_:1})])),_:1}),h(s,{class:"income"},{default:y((()=>[h(s,{class:"detail"},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[ta.value?(m(),p(s,{key:0,class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>[k("0")])),_:1}),h(s,{class:"diamond-image"})])),_:1})):$((m(),p(s,{key:1,class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>[k(x(ea.value.toBin),1)])),_:1}),h(s,{class:"diamond-image"})])),_:1},512)),[[C,!Y.value]]),$(h(e,{class:"add-text"},{default:y((()=>[k("+")])),_:1},512),[[C,!1]]),$(h(s,{class:"use-card"},{default:y((()=>[h(s,{class:"card"},{default:y((()=>[h(s,{class:O(["props",{"props-match":Y.value,"props-video":Z.value}])},null,8,["class"]),h(e,null,{default:y((()=>[k("x1")])),_:1})])),_:1})])),_:1},512),[[C,Y.value||Z.value]])])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.videoConsumption.tr),1)])),_:1})])),_:1}),h(s,{class:"detail"},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[h(s,{class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>{var a;return[k(x(null==(a=la.value)?void 0:a.toBin),1)]})),_:1}),h(s,{class:"diamond-image"})])),_:1})])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.giftConsumption.tr),1)])),_:1})])),_:1})])),_:1})])),_:1})):(m(),p(s,{key:1},{default:y((()=>[h(s,{class:"detail",style:{"margin-bottom":"48rpx"}},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[h(s,{class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>[k(x(ua.value),1)])),_:1})])),_:1})])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.callDuration.tr),1)])),_:1})])),_:1}),h(s,{class:"income"},{default:y((()=>[h(s,{class:"detail"},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[$(h(s,{class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>[k(x(na.value.toBin),1)])),_:1}),h(s,{class:"diamond-image"})])),_:1},512),[[C,0!=na.value]]),$(h(e,{class:"add-text"},{default:y((()=>[k("+")])),_:1},512),[[C,0!=na.value&&(Y.value||Z.value)]]),$(h(s,{class:"use-card"},{default:y((()=>[h(s,{class:"card"},{default:y((()=>[h(s,{class:O(["props",{"props-match":Y.value,"props-video":Z.value}])},null,8,["class"]),h(e,null,{default:y((()=>[k("x1")])),_:1})])),_:1})])),_:1},512),[[C,Y.value||Z.value]])])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.videoConsumption.tr),1)])),_:1})])),_:1}),h(s,{class:"detail"},{default:y((()=>[h(s,{class:"income-info"},{default:y((()=>[h(s,{class:"cost-fee"},{default:y((()=>[h(e,null,{default:y((()=>{var a;return[k(x(null==(a=la.value)?void 0:a.toBin),1)]})),_:1}),h(s,{class:"diamond-image"})])),_:1})])),_:1}),h(e,{class:"l-text"},{default:y((()=>[k(x(a.$lanKey.giftConsumption.tr),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1}),h(s,{class:"call-content",onClick:da},{default:y((()=>[h(s,{class:"icon"}),h(e,{class:"tip-call"},{default:y((()=>[k(x(1==G.value||2==aa.value?a.$lanKey.continueMatch.tr:a.$lanKey.continueVideoCall.tr),1)])),_:1}),1!=G.value&&2!=aa.value||!I(R)?1==G.value||2==aa.value?(m(),p(s,{key:1,class:"tip tip-price"},{default:y((()=>[h(s,{class:"diamond-image"}),h(e,null,{default:y((()=>[k(x(ea.value.toBin),1)])),_:1}),h(e,{class:"unit"},{default:y((()=>[k(x(a.$lanKey.unit.tr),1)])),_:1})])),_:1})):I(W)?(m(),p(s,{key:2,class:"tip"},{default:y((()=>[h(s,{class:"props props-video"}),h(e,null,{default:y((()=>[k(x(a.$lanKey.free.tr),1)])),_:1})])),_:1})):1!=G.value&&2!=aa.value?(m(),p(s,{key:3,class:"tip tip-price"},{default:y((()=>[h(s,{class:"diamond-image"}),h(e,null,{default:y((()=>{var a;return[k(x(null==(a=X.value)?void 0:a.callPrice.toBin),1)]})),_:1}),h(e,{class:"unit"},{default:y((()=>[k(x(a.$lanKey.unit.tr),1)])),_:1})])),_:1})):T("",!0):(m(),p(s,{key:0,class:"tip"},{default:y((()=>[h(s,{class:"props props-match"}),h(e,null,{default:y((()=>[k(x(a.$lanKey.free.tr),1)])),_:1})])),_:1}))])),_:1})])),_:1}),$(h(s,{class:"command-anchor"},{default:y((()=>[h(s,{class:"top"},{default:y((()=>[h(s,{class:"gradient"}),h(e,null,{default:y((()=>[k(x(a.$lanKey.recommendedHosts.tr),1)])),_:1}),h(s,{class:"gradient"})])),_:1}),h(s,{class:"anchor-list"},{default:y((()=>[(m(!0),P(M,null,B(oa.value,((l,t)=>(m(),p(s,{onClick:a=>{return e=l.userId,void E({url:`/pages/anchor-detail/anchor-detail?anchorUserId=${e}`});var e},class:"anchor-item place-holder-gradient",key:t},{default:y((()=>[h(s,{class:"anchor-item-content",style:D({backgroundImage:`url(${l.cover})`})},{default:y((()=>[h(s,{class:"anchor-status"},{default:y((()=>[h(s,{class:O(["anchor-status-icon",0==l.isOnline?"anchor-status-offline":1==l.isOnline?"anchor-status-online":"anchor-status-busy"])},null,8,["class"]),h(e,{class:O(["anchor-status-tip",0==l.isOnline?"anchor-status-offline-c":1==l.isOnline?"anchor-status-online-c":"anchor-status-busy-c"])},{default:y((()=>[k(x(0==l.isOnline?a.$lanKey.offline.tr:1==l.isOnline?a.$lanKey.online.tr:a.$lanKey.busy.tr),1)])),_:2},1032,["class"])])),_:2},1024),h(s,{class:"anchor-detail"},{default:y((()=>[h(s,{style:{"flex-grow":"1",display:"flex","flex-direction":"column",width:"0"}},{default:y((()=>[h(s,{style:{display:"flex","justify-content":"flex-start","align-items":"center"}},{default:y((()=>[h(s,{class:"countryIcon",style:D({backgroundImage:`url(${l.countryPath})`})},null,8,["style"]),h(e,{class:"country-title"},{default:y((()=>[k(x(l.countryTitle),1)])),_:2},1024)])),_:2},1024),h(e,{class:"anchor-name"},{default:y((()=>[k(x(l.nickname),1)])),_:2},1024)])),_:2},1024),h(s,{onClick:a=>((a,l)=>{l.stopPropagation(),1==(null==a?void 0:a.isOnline)?j({anchorId:null==a?void 0:a.userId}):V({url:`/pages/tab_bar/conversation/msg/msg?anchorId=${null==a?void 0:a.userId}`})})(l,a),class:O(["icon",1==(null==l?void 0:l.isOnline)?"callIcon":"msgIcon"])},null,8,["onClick","class"])])),_:2},1024)])),_:2},1032,["style"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512),[[C,oa.value.length>0]])])),_:1})}}},[["__scopeId","data-v-ac0e3d16"]]);export{z as default};
